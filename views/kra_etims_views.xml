<?xml version="1.0" encoding="utf-8"?>
<odoo>
    
    <!-- KRA eTIMS Configuration Form View -->
    <record id="view_kra_etims_config_form" model="ir.ui.view">
        <field name="name">kra.etims.config.form</field>
        <field name="model">kra.etims.config</field>
        <field name="arch" type="xml">
            <form>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button name="reset_daily_counter" type="object" class="oe_stat_button" icon="fa-refresh">
                            <div class="o_field_widget o_stat_info">
                                <span class="o_stat_text">Reset</span>
                                <span class="o_stat_text">Counter</span>
                            </div>
                        </button>
                    </div>
                    <div class="oe_title">
                        <h1>
                            <field name="name" placeholder="e.g., Main Store eTIMS"/>
                        </h1>
                    </div>
                    <group>
                        <group string="Company Information">
                            <field name="company_id"/>
                            <field name="kra_pin" placeholder="A001234567Z"/>
                            <field name="vat_number"/>
                        </group>
                        <group string="Control Unit Details">
                            <field name="control_unit_serial" placeholder="CU-12345678"/>
                            <field name="control_unit_id"/>
                        </group>
                    </group>
                    
                    <group>
                        <group string="eTIMS API Configuration">
                            <field name="etims_environment" widget="radio"/>
                            <field name="etims_api_url"/>
                            <field name="etims_username"/>
                            <field name="etims_password" password="True"/>
                        </group>
                        <group string="Invoice Counters">
                            <field name="invoice_counter" readonly="1"/>
                            <field name="daily_invoice_counter" readonly="1"/>
                            <field name="last_reset_date" readonly="1"/>
                        </group>
                    </group>
                    
                    <group string="Certificate (Optional)">
                        <field name="certificate_file" filename="certificate_filename"/>
                        <field name="certificate_password" password="True"/>
                    </group>
                    
                    <group>
                        <field name="active"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <!-- KRA eTIMS Configuration List View -->
    <record id="view_kra_etims_config_tree" model="ir.ui.view">
        <field name="name">kra.etims.config.tree</field>
        <field name="model">kra.etims.config</field>
        <field name="arch" type="xml">
            <list>
                <field name="name"/>
                <field name="company_id"/>
                <field name="kra_pin"/>
                <field name="control_unit_serial"/>
                <field name="etims_environment"/>
                <field name="invoice_counter"/>
                <field name="active"/>
            </list>
        </field>
    </record>

    <!-- KRA eTIMS Configuration Action -->
    <record id="action_kra_etims_config" model="ir.actions.act_window">
        <field name="name">KRA eTIMS Configuration</field>
        <field name="res_model">kra.etims.config</field>
        <field name="view_mode">list,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Configure KRA eTIMS Integration
            </p>
            <p>
                Set up your KRA eTIMS credentials and Control Unit details for tax compliance.
            </p>
        </field>
    </record>

    <!-- Enhanced POS Order Form View with KRA Fields -->
    <record id="view_pos_order_form_kra" model="ir.ui.view">
        <field name="name">pos.order.form.kra</field>
        <field name="model">pos.order</field>
        <field name="inherit_id" ref="point_of_sale.view_pos_pos_form"/>
        <field name="arch" type="xml">
            <xpath expr="//notebook" position="inside">
                <page string="KRA eTIMS" name="kra_etims">
                    <group>
                        <group string="Tax Invoice Details">
                            <field name="kra_invoice_number" readonly="1"/>
                            <field name="kra_cu_serial" readonly="1"/>
                            <field name="kra_invoice_counter" readonly="1"/>
                            <field name="kra_signature" readonly="1"/>
                        </group>
                        <group string="Submission Status">
                            <field name="kra_submitted" readonly="1"/>
                            <field name="kra_submission_date" readonly="1"/>
                            <field name="kra_response" readonly="1"/>
                        </group>
                    </group>
                    <group string="QR Code">
                        <field name="kra_qr_code" widget="image" readonly="1"/>
                    </group>
                </page>
            </xpath>
            
            <xpath expr="//field[@name='amount_total']" position="after">
                <field name="receipt_number" readonly="1"/>
                <field name="cashier_name" readonly="1"/>
            </xpath>
        </field>
    </record>

</odoo>
